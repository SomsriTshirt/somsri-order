<script setup lang="ts">
useSeoMeta({
    ogTitle: '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï',
    ogUrl: 'https://order.somsritshirt.com/',
    twitterTitle: '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï',
});

useHead({
    title: '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å',
});

// VARIABLE
const specSheetService = useSpecSheet();
const pending = ref<boolean>(false);
const searchId = ref<string>('');
const error = ref<string | null>('');
const { $toast } = useNuxtApp();

// FUNCTION
async function findSpecsheet() {
    pending.value = true;
    // VALIDATE
    if (!searchId.value) {
        error.value = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
        pending.value = false;
        return;
    }

    const data = await specSheetService.isExist(searchId.value, {
        errorCallback: () => {
            $toast.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ');
        },
    });

    if (data?.status) {
        navigateTo(`/order?id=${searchId.value}`);
        return;
    }

    error.value = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
    pending.value = false;
}
</script>
<template>
    <div>
        <NuxtLayout>
            <h1 class="text-center text-primary-500 dark:text-primary-400 text-5xl font-bold mb-3">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏®‡∏£‡∏µ‡∏°‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠</h1>
            <p class="text-center text-xl text-stone-400 mb-10">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ü§©</p>
            <form @submit.prevent="findSpecsheet()">
                <div class="grid grid-cols-12 gap-5">
                    <div class="col-span-12 sm:col-span-9 lg:col-span-10 h-full">
                        <Input v-model="searchId" type="text" class="w-full h-full" :class="{ 'border-red-500': error }" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ" :disabled="pending" />
                        <p v-if="error" class="text-error mt-2">{{ error }}</p>
                    </div>
                    <Button class="col-span-12 sm:col-span-3 lg:col-span-2 text-lg h-full" :disabled="pending">
                        <IconCSS name="material-symbols:search-rounded" size="2rem" class="mr-1" />‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</Button
                    >
                </div>
            </form>
        </NuxtLayout>
    </div>
</template>
